<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <title>Aura for PHP : Aura.Di</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">

        <link rel="alternate" type="application/atom+xml" title="Atom" href="http://auraphp.com/blog/atom.xml" />

        <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
        <link rel="manifest" href="/favicon/manifest.json">

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/magula.min.css">
        <link rel="stylesheet" href="/css/spacelab.css">
        <link rel="stylesheet" href="/css/aura.css">
        <link rel="stylesheet" href="/css/bootstrap-responsive.min.css">

        <script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script src="/js/vendor/jquery-1.9.1.min.js"></script>
        <script src="/js/vendor/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
        <script src="/js/plugins.js"></script>

    </head>

    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/">Aura for PHP</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li><a href="/about">About</a></li>
                            <li class="active"><a href="/packages">Packages</a></li>
                            <li><a href="/framework">Framework</a></li>
                            <li><a href="/blog">Blog</a></li>
                            <li><a href="/community">Community</a></li>
                            <li><a href="/contributing">Contributing</a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container">

            <script>hljs.initHighlightingOnLoad();</script>
            
<nav class="navheader">
    <table>
        <tr>
            <th colspan="3" class="curr">4.5. Aura.Di</th>
        </tr>
        <tr>
            <td class="prev"><a href="/packages/2.x/Cli.html">Aura.Cli</a></td>
            <td class="parent">4. Version 2.x</th>
            <td class="next"><a href="/packages/2.x/Dispatcher.html">Aura.Dispatcher</a></td>
        </tr>
    </table>
</nav>
<div id="section-main"><h1 id="4-5">4.5. Aura.Di</h1>
<p>The Aura.Di package provides a dependency injection container system with the
following features:</p>
<ul>
<li>
<p>constructor and setter injection</p>
</li>
<li>
<p>explicit and implicit auto-resolution of typehinted constructor parameter values</p>
</li>
<li>
<p>configuration of setters across interfaces and traits</p>
</li>
<li>
<p>inheritance of constructor parameter and setter method values</p>
</li>
<li>
<p>lazy-loaded services, values, and instances</p>
</li>
<li>
<p>instance factories</p>
</li>
</ul>
<p>Fully describing the nature and benefits of dependency injection, while
desirable, is beyond the scope of this document. For more information about
"inversion of control" and "dependency injection" please consult
<a href="http://martinfowler.com/articles/injection.html">http://martinfowler.com/articles/injection.html</a> by Martin Fowler.</p>
<p>Finally, please note that this package is intended for use as a <strong>dependency injection</strong> system, not as a <strong>service locator</strong> system. If you use it as a service locator, that's bad, and you should feel bad.</p>
<h2 id="4-5-1">4.5.1. Foreword</h2>
<h3 id="4-5-1-1">4.5.1.1. Installation</h3>
<p>This library requires PHP 5.3 or later; we recommend using the latest available version of PHP as a matter of principle. It has no userland dependencies.</p>
<p>It is installable and autoloadable via Composer as <a href="https://packagist.org/packages/aura/di">aura/di</a>.</p>
<p>Alternatively, <a href="https://github.com/auraphp/Aura.Di/releases">download a release</a> or clone this repository, then require or include its <em>autoload.php</em> file.</p>
<h3 id="4-5-1-2">4.5.1.2. Quality</h3>
<p><a href="https://scrutinizer-ci.com/g/auraphp/Aura.Di/"><img src="https://scrutinizer-ci.com/g/auraphp/Aura.Di/badges/quality-score.png?b=develop-2" alt="Scrutinizer Code Quality"></a>
<a href="https://scrutinizer-ci.com/g/auraphp/Aura.Di/"><img src="https://scrutinizer-ci.com/g/auraphp/Aura.Di/badges/coverage.png?b=develop-2" alt="Code Coverage"></a>
<a href="https://travis-ci.org/auraphp/Aura.Di"><img src="https://travis-ci.org/auraphp/Aura.Di.png?branch=develop-2" alt="Build Status"></a></p>
<p>To run the unit tests at the command line, issue <code>composer install</code> and then <code>phpunit</code> at the package root. This requires <a href="http://getcomposer.org/">Composer</a> to be available as <code>composer</code>, and <a href="http://phpunit.de/manual/">PHPUnit</a> to be available as <code>phpunit</code>.</p>
<p>This library attempts to comply with <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-1-basic-coding-standard.md">PSR-1</a>, <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md">PSR-2</a>, and <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader.md">PSR-4</a>. If
you notice compliance oversights, please send a patch via pull request.</p>
<h3 id="4-5-1-3">4.5.1.3. Community</h3>
<p>To ask questions, provide feedback, or otherwise communicate with other Aura users, please join our <a href="http://groups.google.com/group/auraphp">Google Group</a>, follow <a href="http://twitter.com/auraphp">@auraphp on Twitter</a>, or chat with us on #auraphp on Freenode.</p>
<h2 id="4-5-2">4.5.2. Getting Started</h2>
<h3 id="4-5-2-1">4.5.2.1. Instantiation</h3>
<p>We instantiate a <em>Container</em> like so:</p>
<pre><code class="language-php">&lt;?php
use Aura\Di\Container;
use Aura\Di\Factory;

$di = new Container(new Factory);
?&gt;
</code></pre>
<p>We can then set shared services on the container. Additionally, we can add default constructor parameters and setter method values to be used on new class instances, along with other values as well.</p>
<h3 id="4-5-2-2">4.5.2.2. Setting And Getting Services</h3>
<p>A "service" is an object stored in the <em>Container</em> under a unique name. Any time you <code>get()</code> the named service, you always get back the same object instance.</p>
<pre><code class="language-php">&lt;?php
// define the Example class
class Example
{
    // ...
}

// set the service
$di-&gt;set('service_name', new Example);

// get the service
$service1 = $di-&gt;get('service_name');
$service2 = $di-&gt;get('service_name');

// the two service objects are the same
var_dump($service1 === $service2); // true
?&gt;
</code></pre>
<p>That usage is great if we want to create the <em>Example</em> instance at the same time we set the service. However, we generally want to create the service instance at the moment we <em>get</em> it, not at the moment we <em>set</em> it.</p>
<p>The technique of delaying instantiation until <code>get()</code> time is called "lazy loading." To lazy-load an instance, use the <code>lazyNew()</code> method on the <em>Container</em> and give it the class name to be created:</p>
<pre><code class="language-php">&lt;?php
// set the service as a lazy-loaded new instance
$di-&gt;set('service_name', $di-&gt;lazyNew('Example'));
?&gt;
</code></pre>
<p>Now the service is created only when we we <code>get()</code> it, and not before. This lets us set as many services as we want, but only incur the overhead of creating the instances we actually use.</p>
<h3 id="4-5-2-3">4.5.2.3. Constructor Injection</h3>
<p>When we use the <em>Container</em> to instantiate a new object, we often need to inject (i.e., set) constructor parameter values in various ways.</p>
<h4 id="4-5-2-3-1">4.5.2.3.1. Default Parameter Values</h4>
<p>We can define default values for constructor parameters using the <code>$di-&gt;params</code> array on the <em>Container</em>.</p>
<p>Let's look at a class that takes some constructor parameters:</p>
<pre><code class="language-php">&lt;?php
class ExampleWithParams
{
    protected $foo;
    protected $bar;
    public function __construct($foo, $bar)
    {
        $this-&gt;foo = $foo;
        $this-&gt;bar = $bar;
    }
}
?&gt;
</code></pre>
<p>If we were to try to set a service using <code>$di-&gt;lazyNew('ExampleWithParams')</code>, the instantiation would fail. The <code>$foo</code> param is required, and the <em>Container</em> does not know what to use for that value.</p>
<p>To remedy this, we tell the <em>Container</em> what values to use for each <em>ExampleWithParams</em> constructor parameter by name using the <code>$di-&gt;params</code> array:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['ExampleWithParams']['foo'] = 'foo_value';
$di-&gt;params['ExampleWithParams']['bar'] = 'bar_value';
?&gt;
</code></pre>
<p>Now when a service is defined with <code>$di-&gt;lazyNew('ExampleWithParams')</code>, the instantiation will work correctly. Each time we create an <em>ExampleWithParams</em> instance through the <em>Container</em>, it will apply the <code>$di-&gt;params['ExampleWithParams']</code> values.</p>
<h4 id="4-5-2-3-2">4.5.2.3.2. Instance-Specific Parameter Values</h4>
<p>If we want to override the default <code>$di-&gt;params</code> values for a specific new instance, we can pass a <code>$params</code> array as the second argument to <code>lazyNew()</code> to merge with the default values. For example:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;set('service_name', $di-&gt;lazyNew(
    'ExampleWithParams',
    array(
        'bar' =&gt; 'alternative_bar_value',
    )
));
?&gt;
</code></pre>
<p>This will leave the <code>$foo</code> parameter default in place, and override the <code>$bar</code> parameter value, for just that instance of the <em>ExampleWithParams</em>.</p>
<h4 id="4-5-2-3-3">4.5.2.3.3. Lazy-Loaded Services As Parameter Values</h4>
<p>Sometimes a class will need another service as one of its parameters. By way of example, the following class needs a database connection:</p>
<pre><code class="language-php">&lt;?php
class ExampleNeedsService
{
    protected $db;
    public function __construct($db)
    {
        $this-&gt;db = $db;
    }
}
?&gt;
</code></pre>
<p>To inject a shared service as a parameter value, use <code>$di-&gt;lazyGet()</code> so that the service object is not created until the <em>ExampleNeedsService</em> object is created:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['ExampleNeedsService']['db'] = $di-&gt;lazyGet('db_service');
?&gt;
</code></pre>
<p>This keeps the service from being created until the very moment it is needed. If we never instantiate anything that needs the service, the service itself will never be instantiated.</p>
<h4 id="4-5-2-3-4">4.5.2.3.4. Auto-Resolution Of Parameter Values</h4>
<h5 id="4-5-2-3-4-1">4.5.2.3.4.1. A Note About Auto-Resolution</h5>
<p>Auto-resolution turns out to be difficult to debug in many situations. We regret to say that we did not appreciate how difficult until after the feature was released as stable in a major version. As such, we cannot remove it until the next major version.</p>
<p>To mitigate these difficulties, we recommend you <em>always</em> disable auto-resolution when developing shared packages. Further, we suggest you <em>consider</em> disabling auto-resolution when developing or debugging an application built on shared packages.</p>
<p>Auto-resolution is enabled by default. You can disable auto-resolution by calling <code>$di-&gt;setAutoResolve(false)</code>.</p>
<h5 id="4-5-2-3-4-2">4.5.2.3.4.2. How Auto-Resolution Works</h5>
<p>If there is no <code>$di-&gt;params</code> value for a parameter, the <em>Container</em> will fill in the constructor default value.</p>
<p>If the parameter is typehinted as an <code>array</code> but there is no <code>$di-&gt;params</code> value and also no default value, the <em>Container</em> will fill in an empty <code>array()</code>.</p>
<p>If the parameter is typehinted to a class but there is no <code>$di-&gt;params</code> value for that parameter and also no default value, the <em>Container</em> will fill in a <code>lazyNew()</code> call to the typehinted class.</p>
<p>For example, look at the following class; it has a parameter with a default value, a parameter typehinted as an array with no default, and a parameter typehinted to a class with no default:</p>
<pre><code class="language-php">&lt;?php
class ExampleForAutoResolution
{
    public function __construct(array $baz, Example $dib, $foo = 'bar')
    {
        // ...
    }
}
?&gt;
</code></pre>
<p>For each relevant <code>$di-&gt;params['ExampleForAutoResolution']</code> element that is missing, the <em>Container</em> will auto-resolve the missing elements to these values:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['ExampleForAutoResolution']['baz'] = array();
$di-&gt;params['ExampleForAutoResolution']['dib'] = $di-&gt;lazyNew('Example');
$di-&gt;params['ExampleForAutoResolution']['foo'] = 'bar';
?&gt;
</code></pre>
<p>We can set any combination of these explicitly, and those that are not explicitly set will be filled in automatically for us.</p>
<p>(Note that we cannot auto-resolve an <code>array</code> typehint; such typehints are always resolved to an empty <code>array()</code> when no default value is present.)</p>
<h5 id="4-5-2-3-4-3">4.5.2.3.4.3. Explicitly Directing Auto-Resolution Typehints</h5>
<p>We can direct the auto-resolution of class-typehinted constructor parameters by using the <code>$di-&gt;types</code> array.  This allows us to avoid having to specify <code>$di-&gt;params</code> for every typehinted constructor parameter in every class.  (Note that we can still specify explicit params on a specific class to override the auto-resolution.)</p>
<p>We can specify auto-resolution to a new instance of a class of our choosing ...</p>
<pre><code class="language-php">&lt;?php
// auto-resolve all 'ExampleInterface' typehints to a new 'Example' instance
$di-&gt;types['ExampleInterface'] = $di-&gt;lazyNew('Example');

// auto-resolve all 'ExampleParent' typehints to a different concrete class
$di-&gt;types['ExampleParent'] = $di-&gt;lazyNew('ExampleChild');
?&gt;
</code></pre>
<p>... or to a shared service (aka singleton) of our own choosing:</p>
<pre><code class="language-php">&lt;?php
// auto-resolve all 'Db' and 'DbInterface' typehints to a shared service
$di-&gt;types['Db'] = $di-&gt;lazyGet('db_service');
$di-&gt;types['DbInterface'] = $di-&gt;lazyGet('db_service');
?&gt;
</code></pre>
<h3 id="4-5-2-4">4.5.2.4. Setter Injection</h3>
<p>This package supports setter injection in addition to constructor injection. (These can be combined as needed.)</p>
<h4 id="4-5-2-4-1">4.5.2.4.1. Setter Method Values</h4>
<p>After the <em>Container</em> constructs a new instance of an object, we can specify that certain methods should be called with certain values immediately after instantiation by using the <code>$di-&gt;setter</code> array.  Say we have class like the following:</p>
<pre><code class="language-php">&lt;?php
class ExampleWithSetter
{
    protected $foo;

    public function setFoo($foo)
    {
        $this-&gt;foo = $foo;
    }
}
?&gt;
</code></pre>
<p>We can specify that, by default, the <code>setFoo()</code> method should be called with a specific value after construction like so:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;setter['ExampleWithSetter']['setFoo'] = 'foo_value';
?&gt;
</code></pre>
<p>The value can be any valid value: a literal, a call to <code>lazyNew()</code> or <code>lazyGet()</code>, and so on.</p>
<p>Note, however, that auto-resolution <em>does not apply</em> to setter methods. This is because the <em>Container</em> does not know which methods are setters and which are "normal use" methods.</p>
<p>Note also that this works only with explicitly-defined setter methods. Setter methods that exist only via magic <code>__call()</code> will not be honored.</p>
<h4 id="4-5-2-4-2">4.5.2.4.2. Setters In Traits and Interfaces</h4>
<p>If a class uses a setter method via a trait, or implements an interface with a setter method, we can specify the default value for that setter method in relation to the trait or interface. That value will then be applied by default in every class that uses that trait or implements that interface.</p>
<p>For example, let's say we have this trait, interface, and class:</p>
<pre><code class="language-php">&lt;?php
trait ExampleFooTrait
{
    public function setFoo($foo)
    {
        $this-&gt;foo = $foo;
    }
}

interface ExampleBarInterface
{
    public function setBar($bar);
}

class ExampleWithTraitAndInterface implements ExampleBarInterface
{
    use ExampleFooTrait;

    protected $foo;
    protected $bar;

    public function setBar($bar)
    {
        $this-&gt;bar = $bar;
    }
}
?&gt;
</code></pre>
<p>We then define the default setter method values on the trait and interface:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;setter['ExampleFooTrait']['setFoo'] = 'foo_value';
$di-&gt;setter['ExampleBarInterface']['setBar'] = 'bar_value';
?&gt;
</code></pre>
<p>When we call <code>$di-&gt;lazyNew('ExampleWithTraitAndInterface')</code>, those setter methods will be called by the <em>Container</em> with those values.</p>
<p>Note that if we have class-specific <code>$di-&gt;setter</code> values, those will take precedence over the trait and interface setter values.</p>
<h4 id="4-5-2-4-3">4.5.2.4.3. Instance-Specific Setter Values</h4>
<p>As with constructor injection, we can note instance-specific setter values to use in place of the defaults. We do so via the third argument to <code>$di-&gt;lazyNew()</code>. For example:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;set('service_name', $di-&gt;lazyNew(
    'ExampleWithSetters',
    array(), // no $params overrides
    array(
        'setFoo' =&gt; 'alternative_foo_value',
    )
));
?&gt;
</code></pre>
<h3 id="4-5-2-5">4.5.2.5. Lazy Values</h3>
<p>Sometimes we know that a parameter needs to be specified, but we don't know what it will be until later.  Perhaps it is the result of looking up an API key from an environment variable. In these and other cases, we can tell a constructor parameter or setter method to use a "lazy value" and then specify that value elsewhere.</p>
<p>For example, we can configure the <em>Example</em> constructor parameters to use lazy values like so:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['Example']['foo'] = $di-&gt;lazyValue('fooval');
$di-&gt;params['Example']['bar'] = $di-&gt;lazyValue('barval');
?&gt;
</code></pre>
<p>We can then specify at some later time the values of <code>fooval</code> and <code>barval</code> using the <code>$di-&gt;values</code> array:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;values['fooval'] = 'lazy value for foo';
$di-&gt;values['barval'] = 'lazy value for bar';
?&gt;
</code></pre>
<h3 id="4-5-2-6">4.5.2.6. Lazy Include and Require</h3>
<p>Occasionally we will need to <code>include</code> a file that returns a value, such as data file that returns a PHP array:</p>
<pre><code class="language-php">&lt;?php
// /path/to/data.php
return array(
    'foo' =&gt; 'bar',
    'baz' =&gt; 'dib',
    'zim' =&gt; 'gir'
);
?&gt;
</code></pre>
<p>We could set a constructor parameter or setter method value to <code>include "/path/to/data.php"</code>, but that would cause the file to be read filesystem at that moment, instead of at instantiation time.  To lazy-load a file as a value, call <code>$di-&gt;lazyInclude()</code> or <code>$di-&gt;lazyRequire()</code> (depending on your preference for warning levels).</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['ExampleNeedsInclude']['data'] = $di-&gt;lazyInclude('/path/to/data.php');
$di-&gt;params['ExampleNeedsRequire']['data'] = $di-&gt;lazyRequire('/path/to/data.php');
?&gt;
</code></pre>
<h3 id="4-5-2-7">4.5.2.7. Generic Lazy Calls</h3>
<p>It may be that we have a complex bit of logic we need to execute for a value. If none of the existing <code>$di-&gt;lazy*()</code> methods meet our needs, we can wrap an anonymous function or other callable in a <code>lazy()</code> call, and the callable's return will be used as the value.</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['Example']['foo'] = $di-&gt;lazy(function () {
    // complex calculations, and then:
    return $result;
});
?&gt;
</code></pre>
<p>Beware of relying on this too much; if we do, it probably means we need to separate our configuration concerns better than we are currently doing.</p>
<h3 id="4-5-2-8">4.5.2.8. Instance Factory Objects</h3>
<p>Occasionally, a class will need to receive not just an instance, but a factory that is capable of creating a new instance over and over.  For example, say we have a class like the following:</p>
<pre><code class="language-php">&lt;?php
class ExampleNeedsFactory
{
    protected $struct_factory;

    public function __construct($struct_factory)
    {
        $this-&gt;struct_factory = $struct_factory;
    }

    public function getStruct(array $data)
    {
        $struct = $this-&gt;struct_factory-&gt;__invoke($data);
        return $struct;
    }
}

class ExampleStruct
{
    public function __construct(array $data)
    {
        foreach ($data as $key =&gt; $val) {
            $this-&gt;$key = $val;
        }
    }
}
?&gt;
</code></pre>
<p>We can inject an <em>InstanceFactory</em> that creates only <em>ExampleStruct</em> objects using <code>$di-&gt;newFactory()</code>.</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['ExampleNeedsFactory']['struct_factory'] = $di-&gt;newFactory('ExampleStruct');
?&gt;
</code></pre>
<p>Note that the arguments passed to the factory <code>__invoke()</code> method will be passed to the underlying instance constructor sequentially, not by name. This means the <code>__invoke()</code> method works more like the native <code>new</code> keyword, and not like <code>$di-&gt;lazyNew()</code>.  These arguments override any <code>$di-&gt;params</code> values that have been set for the class being factoried; without the overrides, all existing <code>$di-&gt;params</code> values for that class will be honored. (Values from <code>$di-&gt;setter</code> for the class will also be honored, but cannot be overriddden.)</p>
<p>Do not feel limited by the <em>InstanceFactory</em> implementation. We can create and inject factory objects of our own if we like. The <em>InstanceFactory</em> returned by the <code>$di-&gt;newFactory()</code> method is an occasional convenience, nothing more.</p>
<h3 id="4-5-2-9">4.5.2.9. Inheritance Of Parent Values</h3>
<p>Whether by constructor parameters or setter methods, each class "inherits" the values of its parents by default. This means we can set a value on a parent class, and the child class will use it (that is, unless we set an overriding value on the child class).</p>
<p>For example, let's say we have this parent class and this child class:</p>
<pre><code class="language-php">&lt;?php
class ExampleParent
{
    protected $foo;
    protected $bar;

    public function __construct($foo)
    {
        $this-&gt;foo = $foo;
    }

    public function setBar($bar)
    {
        $this-&gt;bar = $bar;
    }
}

class ExampleChild extends ExampleParent
{
    protected $baz;

    public function setBaz($baz)
    {
        $this-&gt;baz = $baz;
    }
}
?&gt;
</code></pre>
<p>We can specify the default values for every class that extends <em>ExampleParent</em> through the <code>$di-&gt;params</code> and <code>$di-&gt;setter</code> values for the <em>ExampleParent</em>.</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['ExampleParent']['foo'] = 'parent_foo';
$di-&gt;setter['ExampleParent']['setBar'] = 'parent_bar';
?&gt;
</code></pre>
<p>When we call <code>$di-&gt;lazyNew('ExampleChild')</code>, the child class will have inherited the defaults from the parent.</p>
<p>We can always override the inherited values by specifying them for the child class directly:</p>
<pre><code class="language-php">&lt;?php
$di-&gt;params['ExampleChild']['foo'] = 'child_foo';
$di-&gt;setter['ExampleChild']['setBaz'] = 'child_baz';
?&gt;
</code></pre>
<p>Note that classes extended from the child class will then inherit those new values. In this way, constructor parameter and setter method values are propagated down the inheritance hierarchy.</p>
<h3 id="4-5-2-10">4.5.2.10. Container Builder and Config Classes</h3>
<p>The <em>ContainerBuilder</em> helps to build <em>Container</em> objects from <em>Config</em> classes and pre-existing service objects. It works using a <a href="http://auraphp.com/blog/2014/04/07/two-stage-config/">two-stage configuration system</a>.</p>
<p>The two stages are "define" and "modify". In the "define" stage, the <em>Config</em> object defines constructor parameter values, setter method values, services, and so on. The <em>ContainerBuilder</em> then locks the <em>Container</em> so that these definitions cannot be changed, and begins the "modify" stage. In the "modify" stage, we may <code>get()</code> services from the <em>Container</em> and modify them programmatically if needed.</p>
<p>To build a <em>Container</em> using the <em>ContainerBuilder</em>, we do something like the following:</p>
<pre><code class="language-php">&lt;?php
use Aura\Di\ContainerBuilder;

// pre-existing service objects as ['service_name' =&gt; $object_instance]
$services = array();

// config classes to call define() and modify() on
$config_classes = array(
    'Aura\Cli\_Config\Common',
    'Aura\Router\_Config\Common',
    'Aura\Web\_Config\Common',
);

// should auto-resolve be enabled or disabled?
// ENABLE_AUTO_RESOLVE is the default;
// use DISABLE_AUTO_RESOLVE to disable it.
$auto_resolve = ContainerBuilder::ENABLE_AUTO_RESOLVE;

// use the builder to create a container
$container_builder = new ContainerBuilder;
$di = $container_builder-&gt;newInstance(
    $services,
    $config_classes,
    $auto_resolve
);
?&gt;
</code></pre>
<p>A configuration class looks like the following:</p>
<pre><code class="language-php">&lt;?php
namespace Vendor\Package\_Config;

use Aura\Di\Config;
use Aura\Di\Container;

class Common extends Config
{
    public function define(Container $di)
    {
        $di-&gt;set('log_service', $di-&gt;lazyNew('Logger'));
        $di-&gt;params['Logger']['dir'] = '/path/to/logs';
    }

    public function modify(Container $di)
    {
        $log = $di-&gt;get('log_service');
        $log-&gt;debug('Finished config.');
    }
}
?&gt;
</code></pre>
<p>Here are some example <em>Config</em> classes from other Aura packages:</p>
<ul>
<li>
<a href="https://github.com/auraphp/Aura.Cli/blob/2.0.0/config/Common.php">Aura.Cli</a>
</li>
<li>
<a href="https://github.com/auraphp/Aura.Html/blob/2.0.0/config/Common.php">Aura.Html</a>
</li>
<li>
<a href="https://github.com/auraphp/Aura.Router/blob/2.0.0/config/Common.php">Aura.Router</a>
</li>
<li>
<a href="https://github.com/auraphp/Aura.View/blob/2.0.0/config/Common.php">Aura.View</a>
</li>
</ul>
<h3 id="4-5-2-11">4.5.2.11. Conclusion</h3>
<p>If we construct our dependencies properly with params, setters, services, and factories, we will only need to get one object directly from the <em>Container</em> in our bootstrap file. All object creation will then occur within <em>Container</em> itself or the various factory objects. We will never need to use the <em>Container</em> itself in any of our application objects.</p>
</div>
<nav class="navfooter">
    <table>
        <tr>
            <td class="prev"><a href="/packages/2.x/Cli.html">Prev</a></td>
            <td class="parent"><a href="/packages/2.x/">Up</a></td>
            <td class="next"><a href="/packages/2.x/Dispatcher.html">Next</a></td>
        </tr>
        <tr>
            <td class="prev">4.4. Aura.Cli</td>
            <td class="parent">4. Version 2.x</td>
            <td class="next">4.6. Aura.Dispatcher</td>
        </tr>
    </table>
</nav>

            <hr />

            <footer>
                <p>&copy; 2011-2022, Aura for PHP
                    <script type="text/javascript">
                        var sc_project=9117595;
                        var sc_invisible=0;
                        var sc_security="b58cd28d";
                        var scJsHost = (("https:" == document.location.protocol) ? "https://secure." : "http://www.");
                        document.write("<sc"+"ript type='text/javascript' src='" + scJsHost+ "statcounter.com/counter/counter.js'></"+"script>");
                    </script>
                    <noscript><div class="statcounter"><a
                        title="site stats"
                        href="http://statcounter.com/free-web-stats/"
                        target="_blank"><img class="statcounter"
                        src="http://c.statcounter.com/9117595/0/b58cd28d/0/"
                        alt="site stats"
                    ></a></div></noscript>
                </p>
            </footer>

        </div>

    </body>
</html>