<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <title>Aura for PHP : Aura.Payload</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">

        <link rel="alternate" type="application/atom+xml" title="Atom" href="http://auraphp.com/blog/atom.xml" />

        <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
        <link rel="manifest" href="/favicon/manifest.json">

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/magula.min.css">
        <link rel="stylesheet" href="/css/spacelab.css">
        <link rel="stylesheet" href="/css/aura.css">
        <link rel="stylesheet" href="/css/bootstrap-responsive.min.css">

        <script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script src="/js/vendor/jquery-1.9.1.min.js"></script>
        <script src="/js/vendor/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
        <script src="/js/plugins.js"></script>

    </head>

    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/">Aura for PHP</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li><a href="/about">About</a></li>
                            <li class="active"><a href="/packages">Packages</a></li>
                            <li><a href="/framework">Framework</a></li>
                            <li><a href="/blog">Blog</a></li>
                            <li><a href="/community">Community</a></li>
                            <li><a href="/contributing">Contributing</a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container">

            <script>hljs.initHighlightingOnLoad();</script>
            
<nav class="navheader">
    <table>
        <tr>
            <th colspan="3" class="curr">3.3. Aura.Payload</th>
        </tr>
        <tr>
            <td class="prev"><a href="/packages/3.x/Intl.html">Aura.Intl</a></td>
            <td class="parent">3. Version 3.x</th>
            <td class="next"><a href="/packages/3.x/Router/">Aura.Router</a></td>
        </tr>
    </table>
</nav>
<div id="section-main"><h1 id="3-3">3.3. Aura.Payload</h1>
<p>You use a <em>Payload</em> as a data transfer object to send domain-layer results to
your user-interface layer, along with meta-data indicating the meaning of the
domain results.</p>
<h2 id="3-3-1">3.3.1. Getting Started</h2>
<p>Instantiating a <em>Payload</em> object is straighforward:</p>
<pre><code class="language-php">&lt;?php
use Aura\Payload\Payload;

$payload = new Payload();
?&gt;
</code></pre>
<p>You can then set the payload status and domain output, along with error codes,
error messages, the input as received by the domain layer, and any extras you
like.</p>
<p>While this may suffice for your particular implementation, there is also a
factory object to allow each call to return its own payload.</p>
<pre><code class="language-php">&lt;?php
use Aura\Payload\PayloadFactory;

$payloadFactory = new PayloadFactory();
$payload = $payloadFactory-&gt;newInstance();
?&gt;
</code></pre>
<h2 id="3-3-2">3.3.2. Methods</h2>
<p>Use these methods in your domain layer to modify the <em>Payload</em>. (All <code>set*()</code>
methods return the <em>Payload</em> object itself, so you can chain the methods
fluently.)</p>
<ul>
<li>
<p><code>setStatus()</code>: Sets the payload status in terms of the domain layer.</p>
</li>
<li>
<p><code>setInput()</code>: Sets the input as received by the domain layer.</p>
</li>
<li>
<p><code>setOutput()</code>: Sets the output produced by the domain layer.</p>
</li>
<li>
<p><code>setMessages()</code>: Sets the messages reported by the domain layer.</p>
</li>
<li>
<p><code>setExtras()</code>: Sets "extra" values produced by the domain layer.</p>
</li>
</ul>
<p>Your calling code can then examine the payload object using the <code>get*()</code>
complements to the the <code>set*()</code> methods.</p>
<ul>
<li>
<p><code>getStatus()</code>: Gets the payload status in terms of the domain layer.</p>
</li>
<li>
<p><code>getInput()</code>: Gets the input as received by the domain layer.</p>
</li>
<li>
<p><code>getOutput()</code>: Gets the output produced by the domain layer.</p>
</li>
<li>
<p><code>getMessages()</code>: Gets the messages reported by the domain layer.</p>
</li>
<li>
<p><code>getExtras()</code>: Gets "extra" values produced by the domain layer.</p>
</li>
</ul>
<h2 id="3-3-3">3.3.3. Status Values</h2>
<p>Several generic status values are available as constants on the
<em>Aura\Payload_Interface\PayloadStatus</em> class:</p>
<ul>
<li>
<code>PayloadStatus::ACCEPTED</code>: A command has been accepted for later processing.</li>
<li>
<code>PayloadStatus::AUTHENTICATED</code>: An authentication attempt succeeded.</li>
<li>
<code>PayloadStatus::AUTHORIZED</code>: An authorization request succeeded.</li>
<li>
<code>PayloadStatus::CREATED</code>: A creation attempt succeeded.</li>
<li>
<code>PayloadStatus::DELETED</code>: A deletion attempt succeeded.</li>
<li>
<code>PayloadStatus::ERROR</code>: There was a major error of some sort.</li>
<li>
<code>PayloadStatus::FAILURE</code>: There was a generic failure of some sort.</li>
<li>
<code>PayloadStatus::FOUND</code>: A query successfullly returned results.</li>
<li>
<code>PayloadStatus::NOT_ACCEPTED</code>: A command failed to be accepted.</li>
<li>
<code>PayloadStatus::NOT_AUTHENTICATED</code>: The user is not authenticated.</li>
<li>
<code>PayloadStatus::NOT_AUTHORIZED</code>: The user is not authorized for the action.</li>
<li>
<code>PayloadStatus::NOT_CREATED</code>: A creation attempt failed.</li>
<li>
<code>PayloadStatus::NOT_DELETED</code>: A deletion attempt failed.</li>
<li>
<code>PayloadStatus::NOT_FOUND</code>: A query failed to return results.</li>
<li>
<code>PayloadStatus::NOT_UPDATED</code>: An update attempt failed.</li>
<li>
<code>PayloadStatus::NOT_VALID</code>: User input was invalid.</li>
<li>
<code>PayloadStatus::PROCESSING</code>: A command is in-process but not finished.</li>
<li>
<code>PayloadStatus::SUCCESS</code>: There was a generic success of some sort.</li>
<li>
<code>PayloadStatus::UPDATED</code>: An update attempt succeeded.</li>
<li>
<code>PayloadStatus::VALID</code>: User input was valid.</li>
</ul>
<p>You should consider creating your own domain-specific payload statuses as well.</p>
<p>Your user-interface layer can use these to determine how to process and present
the domain objects retrieved via <code>Payload::getOutput()</code>.</p>
<h2 id="3-3-4">3.3.4. Example</h2>
<p>Here is a naive example Application Service class that uses a <em>Payload</em> to
return its results. Note how:</p>
<ul>
<li>the <code>browsePosts()</code> method returns either <code>FOUND</code> or <code>NOT_FOUND</code> payloads;</li>
<li>the <code>readPost()</code> method also returns either <code>FOUND</code> or <code>NOT_FOUND</code> payloads;</li>
<li>the <code>editPost()</code> method returns ...
<ul>
<li>... a <code>NOT_FOUND</code> payload if the <code>$id</code> does not exist,</li>
<li>... a <code>NOT_AUTHORIZED</code> payload if the user does not own the post,</li>
<li>... a <code>NOT_VALID</code> payload for invalid input,</li>
<li>... or an <code>UPDATED</code> payload on success;</li>
</ul>
</li>
<li>the <code>addPost()</code> method returns ...
<ul>
<li>... a <code>NOT_VALID</code> payload for invalid input,</li>
<li>... or a <code>CREATED</code> payload on success;</li>
</ul>
</li>
<li>the <code>deletePost()</code> method returns ...
<ul>
<li>... a <code>NOT_FOUND</code> payload if the <code>$id</code> does not exist,</li>
<li>... a <code>NOT_AUTHORIZED</code> payload if the user does not own the post,</li>
<li>... or a <code>DELETED</code> payload on success.</li>
</ul>
</li>
</ul>
<p>Any raised <em>Exception</em> gets transformed into an <code>ERROR</code> payload, with the
exception and the input that led to the problem.</p>
<p>When your user-interface code receives the <em>Payload</em>, it can examine the payload
status to discover exactly what happened in the domain layer, then determine how
to present the information from the domain.</p>
<pre><code class="language-php">&lt;?php
namespace App\Blog;

use Aura\Payload\PayloadFactory;
use Aura\Payload_Interface\PayloadStatus;
use Exception;

class ApplicationService
{
    protected $user;
    protected $mapper;
    protected $filter;
    protected $payloadFactory;

    public function __construct(
        User $user,
        BlogMapper $mapper,
        BlogFilter $filter,
        PayloadFactory $payloadFactory
    ) {
        $this-&gt;user = $user;
        $this-&gt;mapper = $mapper;
        $this-&gt;filter = $filter;
        $this-&gt;payloadFactory = $payloadFactory;
    }

    public function browsePosts($page = 1, $perPage = 10)
    {
        $payload = $this-&gt;payloadFactory-&gt;newInstance();

        try {

            $posts = $this-&gt;mapper-&gt;fetchAllByPage($page, $perPage);
            if (! $posts) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_FOUND)
                    -&gt;setInput(func_get_args());
            }

            return $payload
                -&gt;setStatus(PayloadStatus::FOUND)
                -&gt;setOutput($posts);

        } catch (Exception $e) {
            return $this-&gt;error($e, func_get_args());
        }
    }

    public function readPost($id)
    {
        $payload = $this-&gt;payloadFactory-&gt;newInstance();

        try {

            $post = $this-&gt;mapper-&gt;fetchOneById($id);
            if (! $post) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_FOUND)
                    -&gt;setInput(func_get_args());
            }

            return $payload
                -&gt;setStatus(PayloadStatus::FOUND)
                -&gt;setOutput($post);

        } catch (Exception $e) {
            return $this-&gt;error($e, func_get_args());
        }
    }

    public function editPost($id, array $input)
    {
        $payload = $this-&gt;payloadFactory-&gt;newInstance();

        try {

            $post = $this-&gt;mapper-&gt;fetchOneById($id);
            if (! $post) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_FOUND)
                    -&gt;setInput(func_get_args());
            }

            if (! $post-&gt;isOwnedBy($user)) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_AUTHORIZED)
                    -&gt;setInput(func_get_args());
            }

            $post-&gt;setData($input);
            if (! $this-&gt;filter-&gt;forUpdate($post)) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_VALID)
                    -&gt;setInput($input)
                    -&gt;setOutput($post)
                    -&gt;setMessages($this-&gt;filter-&gt;getMessages());
            }

            $this-&gt;mapper-&gt;update($post);
            return $payload
                -&gt;setStatus(PayloadStatus::UPDATED)
                -&gt;setOutput($post);

        } catch (Exception $e) {
            return $this-&gt;error($e, func_get_args());
        }
    }

    public function addPost(array $input)
    {
        $payload = $this-&gt;payloadFactory-&gt;newInstance();

        try {

            $post = $this-&gt;mapper-&gt;newPost($input);
            if (! $this-&gt;filter-&gt;forInsert($post)) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_VALID)
                    -&gt;setInput($input)
                    -&gt;setOutput($post)
                    -&gt;setMessages($this-&gt;filter-&gt;getMessages());
            }

            $this-&gt;mapper-&gt;create($post);
            return $payload
                -&gt;setStatus(PayloadStatus::CREATED)
                -&gt;setOutput($post);

        } catch (Exception $e) {
            return $this-&gt;error($e, func_get_args());
        }
    }

    public function deletePost($id)
    {
        $payload = $this-&gt;payloadFactory-&gt;newInstance();

        try {

            $post = $this-&gt;mapper-&gt;fetchOneById($id);
            if (! $post) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_FOUND)
                    -&gt;setInput(func_get_args());
            }

            if (! $post-&gt;isOwnedBy($user)) {
                return $payload
                    -&gt;setStatus(PayloadStatus::NOT_AUTHORIZED)
                    -&gt;setInput(func_get_args());
            }

            $this-&gt;mapper-&gt;delete($post);
            return $payload
                -&gt;setStatus(PayloadStatus::DELETED)
                -&gt;setOutput($post);

        } catch (Exception $e) {
            return $this-&gt;error($e, func_get_args());
        }
    }

    protected function error(Exception $e, array $args)
    {
        $payload = $this-&gt;payloadFactory-&gt;newInstance();
        return $payload
            -&gt;setStatus(PayloadStatus::ERROR)
            -&gt;setInput($args)
            -&gt;setOutput($e);
    }
}
?&gt;
</code></pre>
</div>
<nav class="navfooter">
    <table>
        <tr>
            <td class="prev"><a href="/packages/3.x/Intl.html">Prev</a></td>
            <td class="parent"><a href="/packages/3.x/">Up</a></td>
            <td class="next"><a href="/packages/3.x/Router/">Next</a></td>
        </tr>
        <tr>
            <td class="prev">3.2. Aura.Intl</td>
            <td class="parent">3. Version 3.x</td>
            <td class="next">3.4. Aura.Router</td>
        </tr>
    </table>
</nav>

            <hr />

            <footer>
                <p>&copy; 2011-2022, Aura for PHP
                    <script type="text/javascript">
                        var sc_project=9117595;
                        var sc_invisible=0;
                        var sc_security="b58cd28d";
                        var scJsHost = (("https:" == document.location.protocol) ? "https://secure." : "http://www.");
                        document.write("<sc"+"ript type='text/javascript' src='" + scJsHost+ "statcounter.com/counter/counter.js'></"+"script>");
                    </script>
                    <noscript><div class="statcounter"><a
                        title="site stats"
                        href="http://statcounter.com/free-web-stats/"
                        target="_blank"><img class="statcounter"
                        src="http://c.statcounter.com/9117595/0/b58cd28d/0/"
                        alt="site stats"
                    ></a></div></noscript>
                </p>
            </footer>

        </div>

    </body>
</html>